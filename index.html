<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dark Web Simulator</title>
  <style>
    :root {
      --bg:#0b0e16; --card:#121624; --panel:#0f1322; --text:#e7e9ff; --muted:#9aa3c7;
      --acc:#00ff9a; --line:#233055; --btn:#5865F2; --btnh:#4752C4;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100dvh; color:var(--text);
      background: radial-gradient(80vw 80vh at 5% 10%, #0e1330 0, transparent 60%),
                  radial-gradient(60vw 60vh at 95% 90%, #12183a 0, transparent 60%),
                  var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg,#0e1325,#0c1020);
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%; background:var(--acc); box-shadow:0 0 12px var(--acc)}
    .menu-btn{font-size:22px; cursor:pointer; user-select:none}
    nav{display:none; background:var(--panel); border-bottom:1px solid var(--line)}
    nav a{display:block; padding:12px 16px; text-decoration:none; color:var(--text); border-top:1px solid #0c1226}
    nav a:hover{background:#121a35}
    @media(min-width:720px){
      nav{display:flex !important; gap:8px; border:0; background:transparent; padding-right:8px}
      nav a{border:1px solid var(--line); border-radius:10px}
      .menu-btn{display:none}
    }
    .container{max-width:980px; margin:18px auto; padding:0 16px}
    .card{
      background:linear-gradient(180deg,#151a2f,#11162b);
      border:1px solid var(--line); border-radius:16px; padding:18px;
      box-shadow:0 10px 40px rgba(0,0,0,.35);
    }
    .row{display:flex; align-items:center; gap:14px}
    .grow{flex:1}
    h1{margin:6px 0 4px; font-size:1.35rem}
    p{margin:0; color:var(--muted)}
    .actions{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap}
    button,.btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700;
      background:var(--btn); color:#fff; text-decoration:none
    }
    button:hover,.btn:hover{background:var(--btnh)}
    .hidden{display:none !important}
    .panel{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:14px}
    .kv{font-size:.95rem}
    .kv div{display:flex; justify-content:space-between; gap:12px; padding:6px 0; border-bottom:1px dashed #253061}
    .kv div:last-child{border-bottom:0}
    .avatar{width:60px;height:60px;border-radius:50%; border:1px solid #2c366b}
    /* chat */
    .chat-wrap{display:flex; flex-direction:column; gap:12px}
    .chat-inputs{display:flex; flex-wrap:wrap; gap:8px}
    .chat-inputs input{
      flex:1 1 220px; min-width:200px; padding:10px 12px; border-radius:10px;
      border:1px solid var(--line); background:#121733; color:#cfe7ff
    }
    .chat-list{list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px}
    .msg{display:flex; gap:10px; align-items:flex-start; background:#0f142c; border:1px solid #1e2a55; padding:10px; border-radius:12px}
    .msg .meta{font-size:.85rem; color:#9fb0d5}
    .msg .content img{max-width:220px; border-radius:8px; border:1px solid #29356b; margin-top:6px}
    .timer{font-size:.9rem; color:#9fb0d5}
    /* fake .onion bar */
    .onion{
      display:flex; align-items:center; gap:8px; font-family:monospace;
      background:#0d132b; border:1px dashed #2a3b73; color:#9bd7ba; padding:8px 12px; border-radius:10px;
      box-shadow:inset 0 0 12px rgba(0,255,154,.06)
    }
    .tag{padding:2px 6px; border-radius:6px; font-size:.8rem; background:#12233a; border:1px solid #264a7a; color:#a8c7ff}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <span class="dot"></span>
      <strong>Dark Web Simulator</strong>
    </div>
    <div class="menu-btn" id="menuBtn">‚ò∞</div>
    <nav id="menu">
      <a href="#" data-page="home">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
      <a href="#" data-page="chat">‡πÅ‡∏ä‡∏ó</a>
      <a href="#" data-page="ads">‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</a>
      <a href="#" data-page="news">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß</a>
    </nav>
  </header>

  <div class="container">
    <!-- Fake .onion bar -->
    <div class="onion panel" style="margin-bottom:14px">
      <span class="tag">tor://</span>
      <span id="onionAddr"></span>
      <span class="tag" id="torState">SIM MODE</span>
      <a class="btn" id="regenOnion" style="margin-left:auto">‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</a>
    </div>

    <!-- HOME -->
    <section id="page-home" class="card">
      <div class="row">
        <img id="pfp" class="avatar" src="" alt="">
        <div class="grow">
          <h1 id="title">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
          <p id="subtitle">‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Dark Web ‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
        </div>
      </div>
      <div class="actions" id="loggedOut">
        <a class="btn" id="discordLoginBtn">Login with Discord</a>
      </div>
      <div id="loggedIn" class="hidden">
        <div class="kv panel">
          <div><span>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span><span id="uname">-</span></div>
          <div><span>Discord ID</span><span id="uid">-</span></div>
          <div><span>Email</span><span id="uemail">-</span></div>
        </div>
        <div class="actions">
          <button id="copyBtn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Access Token</button>
          <button id="logoutBtn">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>
    </section>

    <!-- CHAT -->
    <section id="page-chat" class="card hidden">
      <h1>‡πÅ‡∏ä‡∏ó</h1>
      <p class="timer">‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <span id="resetCountdown">--:--:--</span></p>
      <div class="chat-wrap">
        <ul class="chat-list" id="chatList"></ul>
        <div class="chat-inputs">
          <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
          <input type="url" id="chatImage" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
          <button class="btn" id="sendBtn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
        </div>
      </div>
      <p style="color:#8fb6ff; margin-top:10px">* ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô Discord ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ</p>
    </section>

    <!-- ADS -->
    <section id="page-ads" class="card hidden">
      <h1>‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</h1>
      <div class="panel">
        <ul id="adsList" style="margin:0; padding-left:18px;"></ul>
      </div>
    </section>

    <!-- NEWS -->
    <section id="page-news" class="card hidden">
      <h1>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß</h1>
      <div class="panel">
        <ul id="newsList" style="margin:0; padding-left:18px;"></ul>
      </div>
    </section>
  </div>

<script>
/** ================== CONFIG ================== */
const CLIENT_ID = "1340250311851380736"; // <‚Äî ‡πÉ‡∏™‡πà Client ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
const SCOPES = ["identify","email"];
const DISCORD_API = "https://discord.com/api";
const REDIRECT_URI = window.location.origin + window.location.pathname; // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÉ‡∏ô Developer Portal

/** ================== NAV / UI ================== */
const $ = (id)=>document.getElementById(id);
const pages = ["home","chat","ads","news"];
$("menuBtn").onclick = () => {
  const menu = $("menu");
  menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
};
Array.from(document.querySelectorAll('nav a[data-page]')).forEach(a=>{
  a.addEventListener('click',(e)=>{
    e.preventDefault();
    showPage(a.dataset.page);
    $("menu").style.display='none';
  });
});
function showPage(page){
  pages.forEach(p => {
    const el = $("page-"+p);
    if(!el) return;
    el.classList.toggle("hidden", p!==page);
  });
}

/** ================== Fake .onion address (SIM) ================== */
function randStr(n){ const chars="abcdefghijklmnopqrstuvwxyz234567"; let s=""; for(let i=0;i<n;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; }
function genOnion(){ return randStr(16)+".onion"; }
function setOnion(){ $("onionAddr").textContent = genOnion(); }
$("regenOnion").onclick = setOnion;
setOnion();

/** ================== DISCORD LOGIN (Implicit Grant) ================== */
function loginDiscord(){
  const params = new URLSearchParams({
    client_id: CLIENT_ID,
    response_type: "token",
    redirect_uri: REDIRECT_URI,
    scope: SCOPES.join(" ")
  });
  location.assign(`${DISCORD_API}/oauth2/authorize?${params.toString()}`);
}
$("discordLoginBtn").onclick = loginDiscord;

async function fetchMe(token){
  const res = await fetch(`${DISCORD_API}/users/@me`, { headers:{Authorization:`Bearer ${token}`}});
  if(!res.ok) throw new Error("user fetch failed");
  return await res.json();
}

function setLoggedOut(){
  $("loggedOut").classList.remove("hidden");
  $("loggedIn").classList.add("hidden");
  $("title").textContent = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö";
  $("subtitle").textContent = "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Dark Web ‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô";
  $("pfp").src = "";
}

function setLoggedIn(user, token){
  $("loggedOut").classList.add("hidden");
  $("loggedIn").classList.remove("hidden");
  $("title").textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${user.username}`;
  $("subtitle").textContent = `${user.username}#${user.discriminator}`;
  $("uname").textContent = `${user.username}#${user.discriminator}`;
  $("uid").textContent = user.id;
  $("uemail").textContent = user.email || "(‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå email)";
  const avatarUrl = user.avatar
    ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128`
    : `https://cdn.discordapp.com/embed/avatars/${Number(user.discriminator)%5}.png`;
  $("pfp").src = avatarUrl;

  $("copyBtn").onclick = async () => {
    await navigator.clipboard.writeText(token);
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
  };
}

function logout(){
  sessionStorage.removeItem("d_access_token");
  setLoggedOut();
}

/** ================== CHAT (24h retention) ================== */
const CHAT_KEY = "dw_chat_messages";
const RESET_KEY = "dw_chat_last_reset";
const DAY_MS = 24*60*60*1000;

function now(){ return Date.now(); }
function ensureWindow(){
  let last = parseInt(localStorage.getItem(RESET_KEY) || "0",10);
  if(!last || (now()-last)>=DAY_MS){
    localStorage.setItem(CHAT_KEY,"[]");
    localStorage.setItem(RESET_KEY, String(now()));
    last = now();
  }
  return last;
}
function timeLeftStr(last){
  const remain = Math.max(0, (last+DAY_MS) - now());
  const hh = String(Math.floor(remain/3600000)).padStart(2,'0');
  const mm = String(Math.floor((remain%3600000)/60000)).padStart(2,'0');
  const ss = String(Math.floor((remain%60000)/1000)).padStart(2,'0');
  return `${hh}:${mm}:${ss}`;
}
function tickCountdown(){
  const last = parseInt(localStorage.getItem(RESET_KEY) || "0",10) || ensureWindow();
  $("resetCountdown").textContent = timeLeftStr(last);
  if((now()-last)>=DAY_MS){ ensureWindow(); renderChat(); }
  requestAnimationFrame(()=>setTimeout(tickCountdown, 500));
}

function getMessages(){
  ensureWindow();
  try { return JSON.parse(localStorage.getItem(CHAT_KEY) || "[]"); }
  catch{ return []; }
}
function saveMessages(arr){
  localStorage.setItem(CHAT_KEY, JSON.stringify(arr));
}

function renderChat(){
  const ul = $("chatList");
  ul.innerHTML = "";
  const msgs = getMessages();
  for(const m of msgs){
    const li = document.createElement("li"); li.className="msg";
    const img = document.createElement("img"); img.className="avatar"; img.src = m.avatar;
    const content = document.createElement("div"); content.className="content";
    const meta = document.createElement("div"); meta.className="meta";
    meta.textContent = `${m.username} ‚Ä¢ ${new Date(m.timestamp).toLocaleString()}`;
    const text = document.createElement("div"); text.textContent = m.text || "";
    content.appendChild(meta);
    if(m.text) content.appendChild(text);
    if(m.image){
      const pic = document.createElement("img"); pic.src = m.image;
      content.appendChild(pic);
    }
    li.appendChild(img); li.appendChild(content);
    ul.appendChild(li);
  }
}

let currentUser = null; // set after login

function sendMessage(){
  if(!currentUser){ alert("‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô Discord ‡∏Å‡πà‡∏≠‡∏ô"); return; }
  const t = $("chatInput").value.trim();
  const u = $("chatImage").value.trim();
  if(!t && !u) return;
  const msgs = getMessages();
  msgs.push({
    username: `${currentUser.username}#${currentUser.discriminator}`,
    avatar: currentUser.avatar
      ? `https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png`
      : `https://cdn.discordapp.com/embed/avatars/${Number(currentUser.discriminator)%5}.png`,
    text: t, image: u, timestamp: now()
  });
  saveMessages(msgs);
  $("chatInput").value = "";
  $("chatImage").value = "";
  renderChat();
}
$("sendBtn").onclick = sendMessage;

/** ================== BOOT ================== */
$("logoutBtn").onclick = logout;

// ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
showPage("home");
setLoggedOut();
ensureWindow();
renderChat();
tickCountdown();

// ‡πÇ‡∏¢‡∏ô token ‡∏à‡∏≤‡∏Å hash ‚Üí sessionStorage ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå hash
(function handleHashToken(){
  if(location.hash){
    const params = new URLSearchParams(location.hash.substring(1));
    const token = params.get("access_token");
    if(token){
      sessionStorage.setItem("d_access_token", token);
      // ‡πÉ‡∏ä‡πâ replaceState ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå hash ‡πÅ‡∏ï‡πà‡∏Ñ‡∏á path ‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub Pages subpath)
      history.replaceState({}, "", REDIRECT_URI);
    }
  }
})();

// ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ token ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏î‡∏∂‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ UI
(async ()=>{
  const token = sessionStorage.getItem("d_access_token");
  if(token){
    try{
      const me = await fetchMe(token);
      currentUser = me;
      setLoggedIn(me, token);
    }catch{
      logout();
    }
  }
})();
</script>
</body>
</html>
