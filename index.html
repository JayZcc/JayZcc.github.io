<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Popcat Battle TH vs KH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    body { background:#0f1222; color:#fff; font-family:sans-serif; text-align:center; margin:0; }
    header { background:#151a2f; padding:10px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:1.5em; }
    header nav select { padding:5px; font-size:1em; }
    #news { background:#222633; padding:10px; margin:0; font-size:1em; }
    #cat { width:250px; cursor:pointer; transition:transform .08s; margin-top:20px; }
    #cat.pop { transform:scale(0.95); }
    #score { font-size:1.5em; margin:20px; }
    #board { display:flex; justify-content:center; gap:50px; margin-top:30px; }
    .country { background:#151a2f; padding:15px; border-radius:10px; width:200px; }
    .country h2 { margin:0 0 10px; }
    .country span { font-size:2em; display:block; }
    #winner { margin-top:30px; font-size:2em; color:yellow; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ± Popcat Battle</h1>
    <nav>
      <select id="country">
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="kh">ğŸ‡°ğŸ‡­ à¹€à¸‚à¸¡à¸£</option>
      </select>
    </nav>
  </header>

  <div id="news">ğŸ“° à¸‚à¹ˆà¸²à¸§à¸ªà¸²à¸£: à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆ Popcat Battle!</div>

  <div id="score">à¸„à¸¸à¸“à¸à¸”à¹„à¸›à¹à¸¥à¹‰à¸§: <span id="myscore">0</span></div>
  <img id="cat" src="https://upload.wikimedia.org/wikipedia/commons/4/41/Cat_close_up.png">

  <div id="board">
    <div class="country">
      <h2>ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</h2>
      <span id="thscore">0</span>
    </div>
    <div class="country">
      <h2>ğŸ‡°ğŸ‡­ à¹€à¸‚à¸¡à¸£</h2>
      <span id="khscore">0</span>
    </div>
  </div>

  <div id="winner"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ğŸ”§ à¹ƒà¸ªà¹ˆ Firebase config à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸•à¸£à¸‡à¸™à¸µà¹‰
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const scoresRef = db.ref("countryScores");
    const newsRef = db.ref("news");

    let userId = localStorage.getItem("popcatUser");
    if(!userId){
      userId = "u"+Math.random().toString(36).substr(2,9);
      localStorage.setItem("popcatUser", userId);
    }

    const cat = document.getElementById("cat");
    const myscoreEl = document.getElementById("myscore");
    const thEl = document.getElementById("thscore");
    const khEl = document.getElementById("khscore");
    const countrySelect = document.getElementById("country");
    const winnerEl = document.getElementById("winner");
    const newsEl = document.getElementById("news");

    let myScore = 0;
    let country = localStorage.getItem("popcatCountry") || "th";
    countrySelect.value = country;

    countrySelect.addEventListener("change", ()=>{
      country = countrySelect.value;
      localStorage.setItem("popcatCountry", country);
    });

    const MAX_SCORE = 1000000000000; // 1,000,000,000,000

    // à¸„à¸°à¹à¸™à¸™ realtime
    scoresRef.on("value", snap=>{
      const data = snap.val() || {th:0, kh:0};
      thEl.textContent = data.th || 0;
      khEl.textContent = data.kh || 0;

      if((data.th||0) >= MAX_SCORE){
        winnerEl.textContent = "ğŸ‡¹ğŸ‡­ à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢ à¸Šà¸™à¸°! ğŸ†";
        cat.style.pointerEvents = "none";
      } else if((data.kh||0) >= MAX_SCORE){
        winnerEl.textContent = "ğŸ‡°ğŸ‡­ à¸›à¸£à¸°à¹€à¸—à¸¨à¸à¸±à¸¡à¸à¸¹à¸Šà¸² à¸Šà¸™à¸°! ğŸ†";
        cat.style.pointerEvents = "none";
      } else {
        winnerEl.textContent = "";
        cat.style.pointerEvents = "auto";
      }
    });

    // à¸‚à¹ˆà¸²à¸§à¸ªà¸²à¸£ realtime
    newsRef.on("value", snap=>{
      const txt = snap.val() || "ğŸ“° à¸‚à¹ˆà¸²à¸§à¸ªà¸²à¸£: à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆ Popcat Battle!";
      newsEl.textContent = txt;
    });

    // à¸à¸”à¹à¸¡à¸§
    cat.addEventListener("click", ()=>{
      myScore++;
      myscoreEl.textContent = myScore;

      cat.classList.add("pop");
      setTimeout(()=>cat.classList.remove("pop"),80);

      // à¸­à¸±à¸›à¹€à¸”à¸•à¸„à¸°à¹à¸™à¸™
      scoresRef.child(country).transaction(val=>{
        if(!val) val = 0;
        return val >= MAX_SCORE ? MAX_SCORE : val+1;
      });
    });
  </script>
</body>
</html>
